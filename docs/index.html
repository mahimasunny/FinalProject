<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elma: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elma
   </div>
   <div id="projectbrief">An event loop manager for embedded systems</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Elma Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Introduction </h1>
<p>User Datagram Protocol(UDP) is used in internet applications to implement low-latency and loss-tolerating commenction. UDP enalbles a process to process communication. This project aims to implement a bidirectional UDP message transferring mechanism between a UDP client and a UDP Server.</p>
<h1>Project Details </h1>
<p>This project is a UDP based iOT application that comprises of a Thermostat(UDP Server) and a Room Heater (UDP client). The thermostat and the heater communicate to each other via UDP. There is also an internal manager in heater side that controls the heater, that is turn the heater on or off. The Thermostat can send the current temperature value to the heater in JSON format. The Thermostat listens to a predefined port for the messages from the Heater.</p>
<p>Heater is a finite state machine that has an on state and an off state. It is initially set to an off state. The internal Manager sends a message to turn on the heater. If the heater is on, it requests for a temperature value from the thermostat. Thermostat then sends back the requested temperature value.</p>
<h1>Installation </h1>
<p>The source code for Elma <a href="https://github.com/mahimasunny/FinalProject">is on Github</a>.</p>
<h2>From the Dockerfile </h2>
<p>You can build the docker environment, described in env/Dockerfile, yourself, with the following commands:</p>
<p>``` git clone <a href="https://github.com/mahimasunny/FinalProject.git">https://github.com/mahimasunny/FinalProject.git</a> cd FinalProject docker build -t myelma . docker run -v $PWD:/source -it myelma bash make ./examples/bin/heater ./examples/bin/thermostat ```</p>
<h1>Implementation </h1>
<h2>*Steps in implementing UDP Server and Client with sockets* </h2>
<p>The following are the steps I followed for the completion of this project.</p><ol type="1">
<li><p class="startli">Socket creation ``` #include &lt;sys/socket.h&gt;</p>
<p class="startli">...</p>
<p class="startli">if ((fd = socket(AF_INET, SOCK_DGRAM, 0)) &lt; 0) { perror("cannot create socket"); return 0; }</p>
<p class="startli">``` where, sockfd is the socket descripton, domain refers to communication domain for example AF_INET (IPv4 protocol) , AF_INET6 (IPv6 protocol), type is SOCK_DGRAM for UDP and protocol value is the value for Internet Protocol which is 0. Here all the input parameters are integers. socket mehod is defined in sys/socket.h.</p>
</li>
<li><p class="startli">Identify a socket Sockets are assigned port numbers or transport addresses.</p>
<p class="startli">In server side ``` struct sockaddr_in myaddr;</p>
<p class="startli">/* bind to an arbitrary return address */ /* because this is the client side, we don't care about the address */ /* since no application will initiate communication here - it will */ /* just send responses */ /* INADDR_ANY is the IP address and 0 is the socket */ /* htonl converts a long integer (e.g. address) to a network representation */ /* htons converts a short integer (e.g. port) to a network representation */</p>
<p class="startli">memset((char *)&amp;myaddr, 0, sizeof(myaddr)); myaddr.sin_family = AF_INET; myaddr.sin_addr.s_addr = htonl(INADDR_ANY); myaddr.sin_port = htons(PORT);</p>
<p class="startli">if (bind(fd, (struct sockaddr *)&amp;myaddr, sizeof(myaddr)) &lt; 0) { perror("bind failed"); return 0; } ``` In the server side, Bind method forcefully binds the PORT address.</p>
</li>
</ol>
<pre class="fragment">Client side: send message to the PORT to which binding was done at the server side.
```
memset((char *)&amp;myaddr, 0, sizeof(myaddr));
myaddr.sin_family = AF_INET;
myaddr.sin_addr.s_addr = htonl(INADDR_ANY);
myaddr.sin_port = htons(0);
```
</pre><ol type="1">
<li><p class="startli">Send message to a server from a client a. Client side sendto is used to send a message from client to server</p>
<p class="startli">``` sendto(fd, buf, strlen(buf), 0, (struct sockaddr *)&amp;remaddr, slen); ``` fd refers to the name of the socket. my_message, provides the starting address of the message we want to send. The flags parameter is 0 for UDP sockets. The remaddr defines the destination address and port number for the message. socklen_t is the length of the address structure: sizeof(struct sockaddr_in).</p>
<p class="startli">b. Receive message at server ``` /* now loop, receiving data and printing what we received */ for (;;) { printf("waiting on port %d\n", PORT); recvlen = recvfrom(fd, buf, BUFSIZE, 0, (struct sockaddr *)&amp;remaddr, &amp;addrlen); printf("received %d bytes\n", recvlen); if (recvlen &gt; 0) { buf[recvlen] = 0; printf("received message: \"s"<br />
", buf); } } /* never exits */</p>
<p class="startli">``` fd refers to the name of the socket. buf is the input data and recvlen is the length of that data The flags parameter is 0 for UDP sockets. remaddr is used to recognize the sender.</p>
</li>
<li><p class="startli">On the client, send a message</p>
<p class="startli">Message from client to server ``` recvlen = recvfrom(s, buf, BUFSIZE, 0, (struct sockaddr *)&amp;remaddr, &amp;addrlen); ```</p>
<p class="startli">Reply from server to client send to remaddr ``` sendto(s, buf, strlen(buf), 0, (struct sockaddr *)&amp;remaddr, addrlen)</p>
<p class="startli">```</p>
<p class="startli">At this stage the client can also send back a message to the server</p>
</li>
<li><p class="startli">Close the socket Eventhough there is no communication to be terminated in UDP, the system needs to be closed to free up memory. ``` close(fd);</p>
<p class="startli">``` fd refers to the file descriptor</p>
</li>
</ol>
<h2>*Steps in implementing Thermostat(UDP Server) and Heater(UDP Client)* </h2>
<ol type="1">
<li>Thermostat listens to a predefined port for the messages from the Heater. <code> </code></li>
<li>The internal Manager of the heater sends a message to turn on the heater. <code> </code></li>
<li>If the heater is on, it requests for a temperature value from the thermostat. <code> </code></li>
<li>Thermostat sends back the requested temperature value in JSON format. <code> </code></li>
</ol>
<h1>Resources used </h1>
<p><em>Libraries</em> Elma C++ libararies such as iostream, json/json.h, map, string sys/socket.h netdb.h arpa/inet.h</p>
<p><em>Other References</em> <a href="https://www.cs.rutgers.edu/~pxk/417/notes/sockets/udp.html">https://www.cs.rutgers.edu/~pxk/417/notes/sockets/udp.html</a> <a href="https://www.geeksforgeeks.org/socket-programming-cc/">https://www.geeksforgeeks.org/socket-programming-cc/</a> <a href="https://pubs.opengroup.org/onlinepubs/7908799/xns/syssocket.h.html">https://pubs.opengroup.org/onlinepubs/7908799/xns/syssocket.h.html</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
  <hr class="footer"/><address class="footer"><small>
  Developed by <a href="http://klavinslab.org">Eric Klavins</a> for UW ECE P 520<br>
  Generated on Sun Mar 24 2019 06:13:04 for Elma by &#160;<a href="http://www.doxygen.org/index.html">
  Doxygen
  </a> 1.8.8
  </small></address>
  </body>
  </html>